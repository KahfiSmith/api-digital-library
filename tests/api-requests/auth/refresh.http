@baseUrl = {{$dotenv API_BASE_URL}}
@token = {{$dotenv ACCESS_TOKEN}}
@token = {{token}}
@refreshToken = {{refreshToken}}

### Refresh token using cookie (automatic - after login with cookie)
POST {{baseUrl}}/auth/refresh
Content-Type: application/json

### Refresh token using body (uses global {{refreshToken}} if set)
> {%
try {
  const body = response.body;
  const tokens = body?.data?.tokens || body?.tokens;
  if (tokens?.accessToken) {
    client.global.set("token", tokens.accessToken);
    client.log("ðŸ”„ Updated global token (accessToken)");
  }
  if (tokens?.refreshToken) {
    client.global.set("refreshToken", tokens.refreshToken);
  }
} catch (e) {}
%}

POST {{baseUrl}}/auth/refresh
Content-Type: application/json

{
  "refreshToken": "{{refreshToken}}"
}

### Refresh with empty body (should use cookie if available)
> {%
try {
  const body = response.body;
  const tokens = body?.data?.tokens || body?.tokens;
  if (tokens?.accessToken) {
    client.global.set("token", tokens.accessToken);
    client.log("ðŸ”„ Updated global token (accessToken)");
  }
  if (tokens?.refreshToken) {
    client.global.set("refreshToken", tokens.refreshToken);
  }
} catch (e) {}
%}

POST {{baseUrl}}/auth/refresh
Content-Type: application/json

{}

### Refresh with invalid token (should fail with 401)
> {%
try {
  const body = response.body;
  const tokens = body?.data?.tokens || body?.tokens;
  if (tokens?.accessToken) {
    client.global.set("token", tokens.accessToken);
    client.log("ðŸ”„ Updated global token (accessToken)");
  }
  if (tokens?.refreshToken) {
    client.global.set("refreshToken", tokens.refreshToken);
  }
} catch (e) {}
%}

POST {{baseUrl}}/auth/refresh
Content-Type: application/json

{
  "refreshToken": "invalid_token"
}

### Refresh without token and no cookie (should fail with 401)
> {%
try {
  const body = response.body;
  const tokens = body?.data?.tokens || body?.tokens;
  if (tokens?.accessToken) {
    client.global.set("token", tokens.accessToken);
    client.log("ðŸ”„ Updated global token (accessToken)");
  }
  if (tokens?.refreshToken) {
    client.global.set("refreshToken", tokens.refreshToken);
  }
} catch (e) {}
%}
POST {{baseUrl}}/auth/refresh
Content-Type: application/json

{}
